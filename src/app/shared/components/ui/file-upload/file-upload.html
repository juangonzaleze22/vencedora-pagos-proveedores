<div class="w-full">
  <!-- Área de carga (visible si no hay archivos, o si es múltiple y no se alcanzó el límite) -->
  @if (!hasFiles() || (multiple && !isMaxFilesReached())) {
    <div class="flex flex-col items-center justify-center px-6 pt-8 pb-8 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors min-h-[120px]">
      <p-fileUpload 
        #fileUpload
        mode="basic"
        [accept]="accept"
        [maxFileSize]="maxFileSize"
        [multiple]="multiple"
        [auto]="false"
        chooseLabel="Subir Comprobante"
        chooseIcon="pi pi-upload"
        emptyLabel=""
        (onSelect)="onFileSelect($event)"
        (onError)="onError($event)"
        styleClass="w-full file-upload-custom" />
      <p class="mt-3 text-sm text-gray-500 dark:text-gray-400 text-center font-medium">
        PNG, JPG, PDF hasta 5MB
      </p>
    </div>
  }

  <!-- Grid de archivos cargados -->
  @if (hasFiles()) {
    <div class="grid grid-cols-3 gap-2" [class.mt-3]="multiple">
      @for (preview of filePreviews(); track $index) {
        <div class="relative group border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-gray-50 dark:bg-gray-800/50">
          <!-- Botón eliminar siempre visible -->
          <button
            type="button"
            class="absolute top-1 right-1 w-6 h-6 flex items-center justify-center rounded-full bg-black/60 hover:bg-red-600 text-white transition-colors cursor-pointer shadow-sm"
            style="z-index: 50"
            (click)="onRemoveAt($index)">
            <i class="pi pi-times text-xs"></i>
          </button>

          @if (preview.isImage && preview.previewUrl) {
            <!-- Preview de imagen -->
            <div class="aspect-square">
              <app-lazy-image
                [src]="preview.previewUrl"
                [alt]="preview.isExisting ? 'Comprobante actual del pago' : preview.name"
                width="100%"
                height="100%"
                objectFit="cover"
                [rounded]="false"
                [preview]="true" 
                />
            </div>
            <div class="px-2 py-1.5">
              <p class="text-xs font-medium text-gray-700 dark:text-gray-300 truncate">
                {{ preview.isExisting ? 'Comprobante' : preview.name }}
              </p>
              @if (!preview.isExisting && preview.size) {
                <p class="text-[10px] text-gray-500 dark:text-gray-400">
                  {{ preview.size }}
                </p>
              }
            </div>
          } @else {
            <!-- Preview de PDF u otro archivo -->
            <div class="aspect-square flex flex-col items-center justify-center">
              <div class="w-10 h-10 bg-red-100 dark:bg-red-900/20 rounded-lg flex items-center justify-center">
                <i class="pi pi-file-pdf text-xl text-red-600 dark:text-red-400"></i>
              </div>
            </div>
            <div class="px-2 py-1.5">
              <p class="text-xs font-medium text-gray-700 dark:text-gray-300 truncate">
                {{ preview.name }}
              </p>
              @if (preview.size) {
                <p class="text-[10px] text-gray-500 dark:text-gray-400">
                  {{ preview.size }}
                </p>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
